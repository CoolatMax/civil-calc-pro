<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civil Calc Pro | Professional Engineering Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="src/styles/main.css">
    <style>
        .active-link { border-left: 4px solid #2563eb; }
        .sidebar-link { transition: all 0.2s ease; cursor: pointer; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 antialiased">

    <div class="flex">
        <aside class="fixed inset-y-0 left-0 w-64 bg-white border-r border-gray-200 z-50 overflow-y-auto hidden md:block">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-blue-600">Civil Calc Pro</h1>
                <p class="text-[10px] text-gray-400 uppercase tracking-widest mt-1">Professional Suite v1.0</p>
            </div>
            
            <nav class="mt-4 px-3 space-y-1" id="main-nav">
                <p class="px-3 text-xs font-semibold text-gray-400 uppercase mb-2">Calculators</p>
                </nav>

            <div class="mt-8 px-3 space-y-1">
                <p class="px-3 text-xs font-semibold text-gray-400 uppercase mb-2">Documentation</p>
                <a href="docs/api-ref.md" class="block px-3 py-2 text-sm text-blue-500 hover:underline">ðŸ“„ API Reference</a>
                <a href="docs/cli-usage.md" class="block px-3 py-2 text-sm text-blue-500 hover:underline">ðŸ’» CLI Guide</a>
            </div>
        </aside>

        <main class="flex-1 md:ml-64 min-h-screen p-6 md:p-10">
            <div class="max-w-4xl mx-auto">
                <div id="tool-header" class="mb-8">
                    <h2 id="tool-title" class="text-3xl font-bold text-gray-800 tracking-tight">Select a Tool</h2>
                    <p id="tool-desc" class="text-gray-500 mt-2">Choose a calculator from the sidebar to begin.</p>
                </div>

                <div id="tool-ui-container" class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                    </div>

                <div id="results-display" class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
                    </div>
            </div>
        </main>
    </div>

    <script type="module">
        import CivilCalc from './src/logic/calculators.js';
        import { UIComponents } from './src/components/CalculatorCards.js';

        const navContainer = document.getElementById('main-nav');
        const viewport = document.getElementById('tool-ui-container');
        const resultsArea = document.getElementById('results-display');

        // Centralized Tool Registry
        const tools = [
            { id: 'concrete', name: '1. Concrete & Steel', desc: 'Material estimation with 1.54 dry volume factor.' },
            { id: 'length', name: '2. Length Converter', desc: 'Instant conversion between Metric and Imperial.' },
            { id: 'earthwork', name: '3. Earthwork', desc: 'Excavation and backfill volume with slope logic.' },
            { id: 'bricks', name: '11. Brickwork & Mortar', desc: 'Calculate brick counts and wet/dry mortar.' },
            { id: 'steel', name: '6. Steel Weight', desc: 'Reinforcement bar weight based on diameter.' },
            { id: 'rate', name: '16. Rate Analysis', desc: 'Professional cost and labor breakdown.' }
        ];

        // 1. Build Sidebar
        tools.forEach(tool => {
            const btn = document.createElement('div');
            btn.className = 'sidebar-link flex items-center px-3 py-2 rounded-md text-gray-600 hover:bg-gray-100 mb-1';
            btn.innerText = tool.name;
            btn.onclick = () => loadTool(tool);
            navContainer.appendChild(btn);
        });

        // 2. Load Tool Logic
        function loadTool(tool) {
            // Update UI State
            document.querySelectorAll('.sidebar-link').forEach(l => {
                l.classList.remove('active-link', 'bg-blue-50', 'text-blue-600');
            });
            event.currentTarget.classList.add('active-link', 'bg-blue-50', 'text-blue-600');

            document.getElementById('tool-title').innerText = tool.name;
            document.getElementById('tool-desc').innerText = tool.desc;
            resultsArea.innerHTML = ""; // Clear old results

            const templateKey = tool.id + 'Card';
            const cardHtml = UIComponents[templateKey];

            if (cardHtml) {
                viewport.innerHTML = cardHtml;
                attachToolLogic(tool.id);
            } else {
                viewport.innerHTML = `
                    <div class="p-12 text-center border-2 border-dashed rounded-xl">
                        <p class="text-gray-400 italic">The <b>${tool.name}</b> module is currently being calibrated for v1.1.</p>
                    </div>`;
            }
        }

        // 3. Attach Event Listeners
        function attachToolLogic(id) {
            if (id === 'concrete') {
                document.getElementById('calc-concrete').onclick = () => {
                    const l = parseFloat(document.getElementById('L').value) || 0;
                    const w = parseFloat(document.getElementById('W').value) || 0;
                    const d = parseFloat(document.getElementById('D').value) || 0;
                    const res = CivilCalc.calculateConcrete(l, w, d);
                    renderConcreteResults(res);
                };
            } 
            else if (id === 'length') {
                document.getElementById('calc-length').onclick = () => {
                    const val = parseFloat(document.getElementById('unit-val').value) || 0;
                    const from = document.getElementById('unit-from').value;
                    const to = document.getElementById('unit-to').value;
                    const converted = CivilCalc.convertLength(val, from, to); 
                    resultsArea.innerHTML = `
                        <div class="col-span-full p-6 bg-green-50 rounded-xl border border-green-100 text-center">
                            <span class="text-green-600 text-xs font-bold uppercase">Converted Result</span>
                            <div class="text-4xl font-mono font-bold">${converted.toFixed(3)} ${to}</div>
                        </div>`;
                };
            }
        }

        function renderConcreteResults(res) {
            resultsArea.innerHTML = `
                <div class="p-6 bg-blue-50 rounded-xl border border-blue-100">
                    <p class="text-blue-600 text-xs font-bold uppercase">Cement Bags</p>
                    <p class="text-3xl font-mono font-bold">${res.cementBags.toFixed(2)}</p>
                </div>
                <div class="p-6 bg-white rounded-xl border border-gray-200">
                    <p class="text-gray-400 text-xs font-bold uppercase">Sand (mÂ³)</p>
                    <p class="text-3xl font-mono font-bold">${res.sand.toFixed(3)}</p>
                </div>
                <div class="p-6 bg-white rounded-xl border border-gray-200">
                    <p class="text-gray-400 text-xs font-bold uppercase">Aggregate (mÂ³)</p>
                    <p class="text-3xl font-mono font-bold">${res.aggregate.toFixed(3)}</p>
                </div>
            `;
        }

        // Global function for live schematic updates
        window.updateSchematic = function(dim, value) {
            const label = document.getElementById('label-' + dim);
            if (label) {
                label.innerText = value ? value + 'm' : dim;
            }
        };

        // Load Default Tool
        loadTool(tools[0]);
    </script>
</body>
</html>