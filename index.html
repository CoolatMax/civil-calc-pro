<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civil Calc Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .active-link { border-left: 4px solid #2563eb; background: #eff6ff; color: #2563eb; }
        .sidebar-link { cursor: pointer; transition: 0.2s; }
    </style>
</head>
<body class="bg-gray-50 flex">

    <aside class="w-64 min-h-screen bg-white border-r border-gray-200 fixed">
        <div class="p-6"><h1 class="text-xl font-bold text-blue-600">Civil Calc Pro</h1></div>
        <nav id="sidebar-nav" class="px-4 space-y-1"></nav>
    </aside>

    <main class="ml-64 flex-1 p-10">
        <div class="max-w-3xl mx-auto">
            <h2 id="tool-title" class="text-3xl font-bold mb-2"></h2>
            <p id="tool-desc" class="text-gray-500 mb-8"></p>
            
            <div id="viewport" class="bg-white p-8 rounded-xl border border-gray-200 shadow-sm"></div>
            <div id="results" class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4"></div>
        </div>
    </main>

    <script type="module">
        import CivilCalc from './src/logic/calculators.js';
        import { UIComponents } from './src/components/CalculatorCards.js';

        const tools = [
            { id: 'concrete', name: '1. Concrete & Steel', desc: 'Material estimation with 1.54 factor.' },
            { id: 'length', name: '2. Length Converter', desc: 'Metric to Imperial conversion.' },
            { id: 'earthwork', name: '3. Earthwork', desc: 'Excavation volume calculations.' },
            { id: 'bricks', name: '11. Brickwork & Mortar', desc: 'Brick counts and mortar requirements.' }
        ];

        function init() {
            const nav = document.getElementById('sidebar-nav');
            tools.forEach(tool => {
                const a = document.createElement('a');
                a.className = 'sidebar-link block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-50';
                a.innerText = tool.name;
                a.onclick = () => loadTool(tool);
                nav.appendChild(a);
            });
            loadTool(tools[0]);
        }

        function loadTool(tool) {
            document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active-link'));
            event?.target.classList.add('active-link');

            document.getElementById('tool-title').innerText = tool.name;
            document.getElementById('tool-desc').innerText = tool.desc;
            document.getElementById('results').innerHTML = "";

            const html = UIComponents[tool.id + 'Card'];
            const view = document.getElementById('viewport');
            view.innerHTML = html || `<p class="text-gray-400">Template coming soon...</p>`;

            if (html) bindLogic(tool.id);
        }

        function bindLogic(id) {
            const btn = document.getElementById('calc-btn');
            if (!btn) return;

            btn.onclick = () => {
                const results = document.getElementById('results');
                if (id === 'concrete') {
                    const res = CivilCalc.calculateConcrete(
                        parseFloat(document.getElementById('L').value) || 0,
                        parseFloat(document.getElementById('W').value) || 0,
                        parseFloat(document.getElementById('D').value) || 0
                    );
                    results.innerHTML = renderResultCard("Cement Bags", res.cementBags.toFixed(2)) + 
                                       renderResultCard("Sand (m続)", res.sand.toFixed(3)) + 
                                       renderResultCard("Aggregate (m続)", res.aggregate.toFixed(3));
                } 
                else if (id === 'length') {
                    const val = CivilCalc.convertLength(
                        parseFloat(document.getElementById('unit-val').value) || 0,
                        document.getElementById('unit-from').value,
                        document.getElementById('unit-to').value
                    );
                    results.innerHTML = renderResultCard("Converted Value", val.toFixed(3), "col-span-full");
                }
                else if (id === 'earthwork') {
                    const res = CivilCalc.calculateEarthwork(
                        parseFloat(document.getElementById('e-L').value) || 0,
                        parseFloat(document.getElementById('e-W').value) || 0,
                        parseFloat(document.getElementById('e-D').value) || 0
                    );
                    results.innerHTML = renderResultCard("Excavation Vol", res.volume.toFixed(3) + " m続", "col-span-full");
                }
                else if (id === 'bricks') {
                    const res = CivilCalc.calculateBricks(parseFloat(document.getElementById('wall-vol').value) || 0);
                    results.innerHTML = renderResultCard("Total Bricks", res.totalBricks) + 
                                       renderResultCard("Mortar (m続)", res.mortarVol.toFixed(3));
                }
            };
        }

        function renderResultCard(label, val, span = "") {
            return `<div class="${span} p-4 bg-white border rounded-lg shadow-sm">
                <p class="text-xs text-gray-400 uppercase font-bold">${label}</p>
                <p class="text-2xl font-mono text-blue-600">${val}</p>
            </div>`;
        }

        window.updateSchematic = (dim, val) => {
            const el = document.getElementById('label-' + dim);
            if (el) el.innerText = val ? val + 'm' : dim;
        };

        init();
    </script>
</body>
</html>