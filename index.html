<nav class="mt-4 px-3 space-y-1" id="main-nav">
    <p class="px-3 text-xs font-semibold text-gray-400 uppercase mb-2">Calculators</p>
    </nav>

<script type="module">
    import CivilCalc from './src/logic/calculators.js';
    import { UIComponents } from './src/components/CalculatorCards.js';

    const navContainer = document.getElementById('main-nav');
    const viewport = document.getElementById('tool-ui-container');
    const resultsArea = document.getElementById('results-display');
    const toolTitle = document.getElementById('tool-title');
    const toolDesc = document.getElementById('tool-desc');

    // Full List of 16 Tools
    const tools = [
        { id: 'concrete', name: '1. Concrete & Steel', desc: 'Material estimation with 1.54 dry volume factor.' },
        { id: 'length', name: '2. Length Converter', desc: 'Instant conversion between Metric and Imperial.' },
        { id: 'earthwork', name: '3. Earthwork', desc: 'Excavation and backfill volume with slope logic.' },
        { id: 'bricks', name: '11. Brickwork & Mortar', desc: 'Calculate brick counts and wet/dry mortar.' },
        { id: 'steel', name: '6. Steel Weight', desc: 'Reinforcement bar weight based on diameter.' },
        { id: 'rate', name: '16. Rate Analysis', desc: 'Professional cost and labor breakdown.' }
        // Add remaining tool IDs here as you define them in CalculatorCards.js
    ];

    // Initialize Sidebar
    tools.forEach(tool => {
        const link = document.createElement('a');
        link.className = 'sidebar-link flex items-center px-3 py-2 rounded-md text-gray-600 hover:bg-gray-100 mb-1';
        link.innerText = tool.name;
        link.onclick = () => loadTool(tool);
        navContainer.appendChild(link);
    });

    function loadTool(tool) {
        // Reset UI
        document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active-link', 'bg-blue-50', 'text-blue-600'));
        event.target.classList.add('active-link', 'bg-blue-50', 'text-blue-600');
        
        toolTitle.innerText = tool.name;
        toolDesc.innerText = tool.desc;
        resultsArea.innerHTML = "";

        // Fix for "undefined" error: Ensure ID matches UIComponents keys
        const templateKey = tool.id + 'Card'; 
        viewport.innerHTML = UIComponents[templateKey] || `<p class="p-4 text-gray-400">UI Template for ${tool.name} coming soon...</p>`;

        setupListeners(tool.id);
    }

    function setupListeners(id) {
        if (id === 'concrete') {
            const btn = document.getElementById('calc-concrete');
            const inputs = ['L', 'W', 'D'];
            
            // Fix: Live update the schematic values in the picture
            inputs.forEach(inputId => {
                document.getElementById(inputId).addEventListener('input', (e) => {
                    const label = document.querySelector(`.abs-${inputId}`); // You can add these classes to your SVG text
                    if(label) label.textContent = e.target.value + 'm';
                });
            });

            btn.onclick = () => {
                const res = CivilCalc.calculateConcrete(
                    parseFloat(document.getElementById('L').value) || 0,
                    parseFloat(document.getElementById('W').value) || 0,
                    parseFloat(document.getElementById('D').value) || 0
                );
                renderResults(res);
            };
        }
    }

    function renderResults(res) {
        resultsArea.innerHTML = `
            <div class="p-6 bg-white border rounded-xl shadow-sm text-center">
                <span class="text-gray-400 text-xs uppercase">Cement Bags</span>
                <div class="text-3xl font-bold text-blue-600">${res.cementBags.toFixed(2)}</div>
            </div>
            <div class="p-6 bg-white border rounded-xl shadow-sm text-center">
                <span class="text-gray-400 text-xs uppercase">Sand (m³)</span>
                <div class="text-3xl font-bold">${res.sand.toFixed(3)}</div>
            </div>
            <div class="p-6 bg-white border rounded-xl shadow-sm text-center">
                <span class="text-gray-400 text-xs uppercase">Aggregate (m³)</span>
                <div class="text-3xl font-bold">${res.aggregate.toFixed(3)}</div>
            </div>
        `;
    }

    // Load first tool by default
    loadTool(tools[0]);
</script>